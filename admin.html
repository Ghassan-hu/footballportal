<!DOCTYPE html>
<html >

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>الإدارة - الموافقة على الحجوزات</title>
    <link rel="stylesheet" href="admin.css">
    <link rel="icon" href="./images/Soccer-Player--Streamline-Ultimate.png">
    

    <link rel="preconnect" href="https://fonts.googleapis.com">

    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@100;200;400;700&display=swap" rel="stylesheet">

    <link href="css/bootstrap.min.css" rel="stylesheet">

    <link href="css/bootstrap-icons.css" rel="stylesheet">

    <link href="home.css" rel="stylesheet">
       <!-- Bootstrap CSS -->
       <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
       <!-- Font Awesome -->
       <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
   

   
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.all.min.js"></script>




    <link href="css/main.css" rel="stylesheet">

    <style>
        body {
            padding-top: 56px; /* Adjust this to match the height of the navbar */
        }
        .navbar {
            background-color: #f8f9fa; /* Change to your preferred color */
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .navbar-toggler {
            background-color: green; /* Change border color to green */
        }
        .navbar-toggler:hover {
    background-color: rgb(13, 13, 12); /* Change background color on hover */
          }

.navbar-toggler:hover .navbar-toggler-icon {
    background-color: rgb(17, 17, 16); /* Change icon color on hover */
}
       
        .navbar-nav {
            flex-direction: column; /* Stack items vertically in mobile view */
            align-items: center; /* Align items to the start */
        }
        .btn-logout {
            width: auto; /* Make the button width auto to fit content */
            margin: 10px; /* Add some margin for spacing */
        }

        .input-fieldImg i {
  margin-right: 10px;
  font-size: 1.2em;
  color: #555;
}

.input-fieldImg input[type="file"] {
  border: none;
  outline: none;
  width: 100%;
  background: transparent;
  cursor: pointer;
  display: none; /* Hide the default file input */
}


.input-fieldImg {
 
  align-items: center;
  
  max-width: 100%; /* Adjust as needed */
  transition: all 0.3s ease;
  position: relative;

  display: flex;
  margin-bottom: 10px;
  padding: 5px;
  border: 1px solid #ccc;
  border-radius: 5px;
  background-color: #f9f9f9;
  width: 100%;
}



.input-fieldImg .placeholder {
  display: block;
  flex-grow: 1;
  color: #999;
  cursor: pointer;
  white-space: nowrap; /* Prevent wrapping */
  overflow: hidden; /* Hide overflow */
  text-overflow: ellipsis; /* Show ellipsis for long text */
}

@media (max-width: 375px) {
  .input-fieldImg {
      flex-direction: column;
      align-items: flex-start;
      padding: 8px;
  }

  .input-fieldImg i {
      margin-bottom: 5px;
  }
}

/* Styling to show the file name when selected */
#upload-image:valid + .placeholder::before {
  content: attr(data-file-name);
  color: #333;
}


.upload-label {
  cursor: pointer;
  color: #333;
  margin-left: 10px;
}

#file-name {
  margin-left: 10px;
  color: #666;
  font-size: 14px;
}


  


    </style>


<script>
    // Get username from sessionStorage and update the welcome message
    window.onload = function() {


        if (sessionStorage.getItem('isLoggedIn') !== 'true') {
            window.location.href = 'login.html'; // Redirect to login page
        }

        const username = sessionStorage.getItem('user'); // Retrieve username from sessionStorage
        const welcomeMessage = document.getElementById('WelcomeMessage');

        if (username) {
            welcomeMessage.textContent = `Welcome ${username}`; // Update the message with the username
        }

        fetchUsers();
        fetchMembers(); 

    };
  
       
  

    function logoutUser() {

        sessionStorage.clear(); // Clear all sessionStorage items
        Swal.fire({
    icon: 'success',
    title: 'Success!',
    text: 'Logout successful!',
    showConfirmButton: false, // Hide the confirm button
    timer: 1500 // Show for 1.5 seconds
}).then(() => {
    // Navigate based on user role after the message is dismissed
    sessionStorage.removeItem('isLoggedIn');
    window.location.href = 'index.html'; // Redirect to login page
});
        
    }

</script>


</head>

<body>
    <div class="container-fluid">
       
        <nav class="navbar navbar-expand-lg navbar-light fixed-top">
            <div class="container-fluid">
                <span class="navbar-brand" id="WelcomeMessage" style="margin-left: 20px;">Welcome Admin</span>
        
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
        
                <div class="collapse navbar-collapse" id="navbarNav">
                    <div class="navbar-nav ml-auto topnav" style="margin-right: 20px;">
                        <button class="btn btn-outline-danger btn-logout" onclick="logoutUser()">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </button>
                    </div>
                </div>
            </div>
        </nav>
          
          

           <div style="height:60px ;">

           </div>
        <section id="section_3" style="background-color: #f7f7f7; box-shadow: 0 4px 20px rgba(238, 80, 7, 0.3); border-radius: 8px; padding: 20px; margin: 20px 20px;">
            <!-- <div class="container"> -->
            
                <div class="row">
                
                    <div class="col-md-5">
                        <div class="col-12 text-center mb-4">
                            <a class="btn custom-btn d-block mx-auto" style="width: 100%; max-width: 260px; height: auto; font-size: 1.5rem;">
                                Approved Bookings
                            </a>
                        </div>
                        <div class="table-responsive ">
                            <table class="schedule-table table-hover table table-dark" id="approvedTable">
                                <thead>
                                    <tr>
                                        <th scope="col">Date</th>
                                        <th scope="col">Name</th>
                                        <th scope="col">Time</th>
                                        <th scope="col">Contact</th>
                                        <th scope="col">Amount</th>
                                    </tr>
                                </thead>
                                <tbody>
                                 
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="col-md-1 d-flex align-items-center justify-content-center">
                        <div style="border-left: 2px solid #ccc; height: 100%;"></div>
                    </div>
                    <div class="col-md-5">
                        <div class="col-12 text-center mb-4">
                            <a class="btn custom-btn d-block mx-auto" style="width: 100%; max-width: 250px; height: auto; font-size: 1.5rem;">
                                Declined Bookings
                            </a>
                        </div>
                        <div class="table-responsive">
                            <table class="schedule-table table table-dark" id="DeclinedTable">
                                <thead>
                                    <tr>
                                        <th scope="col">Date</th>
                                        <th scope="col">Name</th>
                                        <th scope="col">Time</th>
                                        <th scope="col">Contact</th>
                                        <th scope="col">Amount</th>
                                    </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            <!-- </div> -->
        </section>

        <section id="section_3" style="background-color: #f7f7f7; box-shadow: 0 4px 20px rgba(238, 80, 7, 0.3); border-radius: 8px; padding: 20px; margin: 20px 20px;">
            <div class="container">
                <div class="row">
                    <div class="col-12 text-center">
                        <div class="text-center mb-4">
                            <a class="btn custom-btn d-block mx-auto" style="width: 100%; max-width: 350px; height: auto; font-size: 1.5rem;">
                                Booking Requests
                            </a>
                        </div>
                        <div class="mb-3">
                            <input type="text" id="searchInput" placeholder="Search by Date, Name, Time, or Contact" onkeyup="filterTable()">
                        </div>
                        <div class="table-responsive">
                            <table class="schedule-table table table-dark" id="AllBookingsTable">
                                <thead>
                                    <tr>
                                        <th scope="col" style="display: none;">ID</th>
                                        <th scope="col">Date</th>
                                        <th scope="col">First Name</th>
                                        <th scope="col">Last Name</th>
                                        <th scope="col">Start Time</th>
                                        <th scope="col">End Time</th>
                                        <th scope="col">Contact</th>
                                        <th scope="col">Amount</th>
                                        <th scope="col">Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Sample Data -->
                                   
                                    <!-- Add more records as needed -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="section_3" style="background-color: #f7f7f7; box-shadow: 0 4px 20px rgba(238, 80, 7, 0.3); border-radius: 8px; padding: 20px; margin: 20px 20px;">
            <div class="container">
                <div class="row">

                    <div class="text-center mb-4">
                        <a class="btn custom-btn d-block mx-auto" style="width: 300px; height: auto; font-size: 1.5rem;">
                            Edit Booking Requests
                        </a>
                    </div>
                    <div class="col-lg-6 col-10 mx-auto">
                        <form id="bookingForm" class="custom-form ticket-form mb-5 mb-lg-0" action="#" method="post" role="form">
                        <h4 class="text-center mb-4">Add/Edit Request!</h4>
                            <div class="ticket-form-body">
                                <input type="hidden" id="bookingID" value="">
                                <div class="row">
                                   
                                    <div class="col-lg-6 col-md-6 col-12">
                                        <input type="text" name="firstname" id="firstnameBooking" class="form-control" placeholder="First Name" style="border-radius: 0.25rem; margin-top: 0;" required>
                                    </div>
                                    <div class="col-lg-6 col-md-6 col-12">
                                        <input type="text" name="lastname" id="lastnameBooking" class="form-control" placeholder="Last Name" style="border-radius: 0.25rem; margin-top: 0;" required>
                                    </div>
                                </div>
                             
                                
                                <input type="tel" class="form-control" name="ticket-form-phone" id="phone"  
                                placeholder="Phone (e.g. 0501234567 or 0591234567)" 
                                pattern="^(05[0-4][0-9]{7}|05[6-9][0-9]{7}|059[0-9]{7})$" required>
                           
                           
                                <div class="row mb-3">
                                    <div class="col-lg-6 col-md-6 col-12">
                                        <label for="todayDate">Booking Date</label>
                                        <input type="date" name="todayDate" id="todayDate" class="form-control" style="border-radius: 0.25rem; margin-top: 0;"  required>
                                       </div>
                                   
                              <div class="col-lg-6 col-md-6 col-12">
                                <label for="startTime">Start Time</label>
                                <input type="time" name="startTime" id="startTime" class="form-control" required>
                              </div>
                               <div class="col-lg-6 col-md-6 col-12">
                                <label for="endTime">End Time</label>
                                <input type="time" name="endTime" id="endTime" class="form-control" disabled>
                              </div>
                               <div class="col-lg-6 col-md-6 col-12">
                                <label for="amount">Amount (₪)</label>
                                <input type="text" name="amount" id="amountBooking" class="form-control" style="border-radius: 0.25rem; margin-top: 0;" disabled>
                                </div>
                              </div>
                                </div>
                                
                                    <button type="button" class="btn btn-info" id="Bookingsadd" style="width: 80px;" onclick="addBookings()">Add</button>
                                    <button type="button" class="btn btn-success" id="Bookingsupdate" style="display:none;width: 80px;" onclick="updateBookings()">Update</button>
                                    <button type="button" class="btn btn-danger" id="Bookingsdelete" style="display:none;width: 80px;" onclick="deleteBookings()">Delete</button>
                                    <button type="button" class="btn btn-warning" id="Bookingscancel" style="display:none;width: 80px;" onclick="clearBookingsForm()">Cancel</button>
                               
                            </div>
                        </form>
                        <div id="responseMessage" class="text-center mt-3"></div>
                    </div>

                  
                </div>
            </div>
        </section>

       

       
        <section id="section_3" style="background-color: #f7f7f7; box-shadow: 0 4px 20px rgba(238, 80, 7, 0.3); border-radius: 8px; padding: 20px; margin: 20px 20px;">
            <div class="container">
                <div class="row">
                    <!-- Table for Academy Members -->
                    <div class="col-md-5">
                        <div class="col-12 text-center mb-4">
                            <a class="btn custom-btn d-block mx-auto" style="width: 100%; max-width: 260px; height: auto; font-size: 1.5rem;">
                                Academy Members
                            </a>
                        </div>
                        <div class="table-responsive">
                            <table class="schedule-table table table-dark" id="membersTable">
                                <thead>
                                    <tr>
                                        <th scope="col" style="display: none;">ID</th>
                                        <th scope="col">Profile</th>
                                        <th scope="col">Name</th>
                                        <th scope="col">Age</th>
                                        <th scope="col">Position</th>
                                    </tr>
                                </thead>
                                <tbody>
                                   
                                </tbody>
                            </table>
                        </div>
                    </div>
        
                    <div class="col-md-2 d-flex align-items-center justify-content-center">
                        <div style="border-left: 2px solid #ccc; height: 100%;"></div>
                    </div>
        
                    <!-- Form to Add/Update Academy Member -->
                    <div class="col-md-5">
                        <div class="col-12 text-center mb-4">
                            <a class="btn custom-btn d-block mx-auto" style="width: 100%; max-width: 400px; height: auto; font-size: 1.5rem;">
                                Add/Update Academy Member
                            </a>
                        </div>
                        <form id="memberForm" class="custom-form ticket-form mb-5 mb-lg-0">
                            <div class="row">
                                <input type="hidden" id="memberRecordId" value="">
                                <label for="profileImage">Profile Image</label>
                                <div class="input-fieldImg">
                                    <i class="fas fa-image"></i>
                                    <input type="file" id="profile-image" style="display: none;" />
                                    <label for="profile-image" class="upload-label">Upload Image</label>
                                    <span id="file-name">No file chosen</span>
                                </div>
                            </div>
                            <div >
                                <label for="MemberName">Name</label>
                                <input type="text" name="Name" id="MemberName" class="form-control" placeholder="Name" required>
                            </div>
                            <div >
                                <label for="MemberAge">Age</label>
                                <input type="text" name="Age" id="MemberAge" class="form-control" placeholder="Age" required>
                            </div>
                            <div >
                                <label for="MemberPosition">Position</label>
                                <input type="text" name="Age" id="MemberPosition" class="form-control" placeholder="Position" required>
                            </div>
                            <button type="button" class="btn btn-info" id="addMemberButton" style="width: 80px;" onclick="addMember()">Add</button>
                            <button type="button" class="btn btn-success" id="updateMemberButton" style="display:none;width: 80px;" onclick="updateMember()">Update</button>
                            <button type="button" class="btn btn-danger" id="deleteMemberButton" style="display:none;width: 80px;" onclick="deleteMember()">Delete</button>
                            <button type="button" class="btn btn-warning" id="cancelMemberButton" style="display:none;width: 80px;" onclick="cancelMemberbtn()">Cancel</button>
                        </form>
                    </div>
                </div>
            </div>
        </section>
        
        <script>

document.getElementById('profile-image').addEventListener('change', function(event) {
    const file = event.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            // Store the base64 string for sending to the API
            window.profileImageBase64 = e.target.result.split(',')[1]; // Remove the data URL part
            document.getElementById('file-name').innerText = file.name; // Display file name
        };
        reader.readAsDataURL(file);
    }
});



             async function fetchMembers() {
    const response = await fetch('https://footballsite-apis-1.onrender.com/api/academies/');
    const users = await response.json();

    const membertableBody = document.getElementById('membersTable').querySelector('tbody');
    membertableBody.innerHTML = ''; // Clear the existing table

    users.forEach(user => {
        const row = document.createElement('tr');
        row.onclick = () => populateMemberFormDet(user);
        row.innerHTML = `
            <td style="display: none;">${user._id}</td>
            <td><img src="data:image/png;base64,${user.profileImage}" alt="Profile Image" style="width:50px; height:50px;"/></td>
            <td>${user.name}</td>
            <td>${user.age}</td>
            <td>${user.position}</td>
        `;
        membertableBody.appendChild(row);
    });
}




            
        
            function populateMemberFormDet(user) {


    document.getElementById('MemberName').value = user.name;
    document.getElementById('MemberAge').value = user.age;
    document.getElementById('MemberPosition').value = user.position;
    document.getElementById('MemberPosition').value = user.position;
    document.getElementById('memberRecordId').value = user._id;
    
    
    window.profileImageBase64 = user.profileImage; // Store the base64 string

    // Set the profile image in the input display (optional)
    const profileImageElement = document.getElementById('profile-image');
    profileImageElement.value = ''; // Reset file input
    document.getElementById('file-name').innerText = 'Image uploaded'; // Indicate an image is already uploaded

    // Show the Update and Delete buttons
    document.getElementById('addMemberButton').style.display = 'none';
    document.getElementById('updateMemberButton').style.display = 'inline-block';
    document.getElementById('deleteMemberButton').style.display = 'inline-block';
    document.getElementById('cancelMemberButton').style.display = 'inline-block';
}

           async function addMember() {
        
            const MemberName = document.getElementById('MemberName').value.trim();
    const MemberAge = document.getElementById('MemberAge').value.trim();
    const MemberPosition = document.getElementById('MemberPosition').value.trim();

    // Check for empty required fields
    if (!MemberName || !MemberAge || !MemberPosition) {
        Swal.fire({
            icon: 'warning',
            title: 'Incomplete Form',
            text: 'Please fill in all required fields.',
        });
        return; // Exit the function if validation fails
    }

    const response = await fetch('https://footballsite-apis-1.onrender.com/api/academies/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            name: MemberName,
            age: MemberAge,
            position: MemberPosition,
            profileImage: window.profileImageBase64 // Send the base64 string
        })
    });

        if (response.ok) {
            
            Swal.fire({
        icon: 'success',
        title: 'Success!',
        text: 'Member added successfully!',
        showConfirmButton: false, // Hide the confirm button
        timer: 1500 // Show for 1.5 seconds
    }).then(() => {
        clearMembersForm();
        fetchMembers(); // Refresh the table
    });
            
        } else {
            
            Swal.fire({
						icon: 'error',
						title: 'Oops!',
						text: 'Failed to add Member!',
						showConfirmButton: false, // Hide the confirm button
                        timer: 1500
					});
        }
            }
        
            async function updateMember() {
   
    const memberId = document.getElementById('memberRecordId').value;
    const MemberName = document.getElementById('MemberName').value;
    const MemberAge = document.getElementById('MemberAge').value;
    const MemberPosition = document.getElementById('MemberPosition').value;

    // Prepare the data to send
    const updatedData = {
        id: memberId,
        name: MemberName,
        age: MemberAge,
        position: MemberPosition,
        profileImage: window.profileImageBase64 // Use the stored base64 image
    };

    const response = await fetch('https://footballsite-apis-1.onrender.com/api/academies/', {
        method: 'PUT', // Use PUT for updating
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(updatedData)
    });

    if (response.ok) {
        Swal.fire({
            icon: 'success',
            title: 'Success!',
            text: 'Member updated successfully!',
            showConfirmButton: false,
            timer: 1500
        }).then(() => {
            clearMembersForm(); // Clear the form after updating
            fetchMembers(); // Refresh the table to show updated data
        });
    } else {
        Swal.fire({
            icon: 'error',
            title: 'Oops!',
            text: 'Failed to update member!',
            showConfirmButton: false,
            timer: 1500
        });
    }
}

async function deleteMember() {

    const memberId = document.getElementById('memberRecordId').value;
    const MemberName = document.getElementById('MemberName').value;
    const MemberAge = document.getElementById('MemberAge').value;
    const MemberPosition = document.getElementById('MemberPosition').value;

    // Prepare the data to send
    const DeletedData = {
        id: memberId
    };


    const confirmation = await Swal.fire({
        title: 'Are you sure?',
        text: "You won't be able to revert this!",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#d33',
        cancelButtonColor: '#3085d6',
        confirmButtonText: 'Yes, delete it!'
    });

    if (confirmation.isConfirmed) {
        const response = await fetch('https://footballsite-apis-1.onrender.com/api/academies/', {
            method: 'DELETE', // Use DELETE for deleting
            headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(DeletedData)
        });

        if (response.ok) {
            Swal.fire({
                icon: 'success',
                title: 'Deleted!',
                text: 'Member has been deleted.',
                showConfirmButton: false,
                timer: 1500
            }).then(() => {
                fetchMembers(); // Refresh the table to show updated data
            });
        } else {
            Swal.fire({
                icon: 'error',
                title: 'Oops!',
                text: 'Failed to delete member!',
                showConfirmButton: false,
                timer: 1500
            });
        }
    }
}


            function cancelMemberbtn() {
                // cancel logic
                clearMembersForm();
            }
        
            function clearMembersForm() {
                document.getElementById('memberForm').reset();
                document.getElementById('profile-image').value = ''; // Reset file input
                document.getElementById('file-name').innerText = 'No file chosen'; // Reset file name display

                document.getElementById('addMemberButton').style.display = 'inline-block';
                document.getElementById('updateMemberButton').style.display = 'none';
                document.getElementById('deleteMemberButton').style.display = 'none';
                document.getElementById('cancelMemberButton').style.display = 'none';
            }
        </script>
        
        

        <section id="section_3" style="background-color: #f7f7f7; box-shadow: 0 4px 20px rgba(238, 80, 7, 0.3); border-radius: 8px; padding: 20px; margin: 20px 20px;">
            <div class="container">
                <div class="row">
                    <!-- Table for Users -->
                    <div class="col-md-5">
                        <div class="col-12 text-center mb-4">
                            <a class="btn custom-btn d-block mx-auto" style="width: 100%; max-width: 260px; height: auto; font-size: 1.5rem;">
                                Users
                            </a>
                        </div>
                        <div class="table-responsive " style="max-height: 400px; overflow-y: auto;">
                            <style>
                                /* Custom Scrollbar Styles */
                                .table-responsive::-webkit-scrollbar {
                                    width: 5px; /* Width of the scrollbar */
                                }
        
                                .table-responsive::-webkit-scrollbar-track {
                                    background: #f1f1f1; /* Background of the scrollbar track */
                                    border-radius: 5px; /* Rounded corners */
                                }
        
                                .table-responsive::-webkit-scrollbar-thumb {
                                    background: #EE5007; /* Color of the scrollbar handle */
                                    border-radius: 5px; /* Rounded corners */
                                }
        
                                .table-responsive::-webkit-scrollbar-thumb:hover {
                                    background: #EE5007; /* Darker color on hover */
                                }
        
                            </style>
                            <table class="schedule-table table table-dark" id="usersTable">
                                <thead>
                                    <tr>
                                        <th scope="col" style="display: none;">ID</th>
                                        <th scope="col">Username</th>
                                        <th scope="col">Role</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- User data will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
        
                    <div class="col-md-2 d-flex align-items-center justify-content-center">
                        <div style="border-left: 2px solid #ccc; height: 100%;"></div>
                    </div>
        
                    <!-- Form to Add/Update User -->
                    <div class="col-md-5">
                        <div class="col-12 text-center mb-4">
                            <a class="btn custom-btn d-block mx-auto" style="width: 100%; max-width: 400px; height: auto; font-size: 1.5rem;">
                                Add/Update User
                            </a>
                        </div>
                        <form id="userForm" class="custom-form ticket-form mb-5 mb-lg-0">
                         
                            <div class="row">
                                <input type="hidden" id="userId" value="">
                                <div class="col-lg-10 col-md-6 col-12">
                                    <label for="username">Username</label>
                                <input type="text" class="form-control" id="username" placeholder="Enter username" required>
                                </div>
                              
                            </div>

                            <div class="row">
                                <div class="col-lg-10 col-md-6 col-12">
                                    <label for="password">Password</label>
                                    <input type="text" class="form-control" id="password" placeholder="Enter password" required>
                                </div>
                              
                            </div>

                            <div class="row mb-3">
                                <div class="col-lg-10 col-md-6 col-12">
                                    <label for="role">Role</label>
                                    <select class="form-control" id="role" style="height: 50px;" required>
                                    
                                        <option value="Academy Member">Academy Member</option>
                                        <option value="Moderator">Moderator</option>
                                        <option value="Admin">Admin</option>
    
                                    </select>
                                </div>
                              
                            </div>

                            
                            <button type="button" class="btn btn-info" id="useraddButton" style="width: 80px;" onclick="addUser()">Add</button>
                            <button type="button" class="btn btn-success" id="userupdateButton" style="display:none;width: 80px;" onclick="updateUser()">Update</button>
                            <button type="button" class="btn btn-danger" id="userdeleteButton" style="display:none;width: 80px;" onclick="deleteUser()">Delete</button>
                            <button type="button" class="btn btn-warning" id="usercancelButton" style="display:none;width: 80px;" onclick="clearForm()">Cancel</button>
                        </form>
                    </div>
                </div>
            </div>
        </section>
        
        <script>
            async function fetchUsers() {
                const response = await fetch('https://footballsite-apis-1.onrender.com/api/users/AllUsers');
                const users = await response.json();
        
                const tableBody = document.getElementById('usersTable').querySelector('tbody');
                tableBody.innerHTML = ''; // Clear the existing table
        
                users.forEach(user => {
                    const row = document.createElement('tr');
                    row.onclick = () => populateUserForm(user);
                    row.innerHTML = `
                     <td style="display: none;" >${user._id}</td>     
                    <td>${user.username}</td>
                    <td>${user.role}</td>
                       
                    `;
                    tableBody.appendChild(row);
                });
            }
        
            function populateUserForm(user) {
                document.getElementById('username').value = user.username;
                document.getElementById('role').value = user.role;
                document.getElementById('userId').value = user._id;
                
        
                // Show the Update and Delete buttons
                document.getElementById('useraddButton').style.display = 'none';
                document.getElementById('userupdateButton').style.display = 'inline-block';
                document.getElementById('userdeleteButton').style.display = 'inline-block';
                document.getElementById('usercancelButton').style.display = 'inline-block';
            }
        
            async function addUser() {
        const username = document.getElementById('username').value.trim();
        const password = document.getElementById('password').value.trim();
        const role = document.getElementById('role').value.trim();

    // Check for empty required fields
    if (!username || !password || !role) {
        Swal.fire({
            icon: 'warning',
            title: 'Incomplete Form',
            text: 'Please fill in all required fields.',
        });
        return; // Exit the function if validation fails
    }

        const response = await fetch('https://footballsite-apis-1.onrender.com/api/users/register', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ username, password, role })
        });

        if (response.ok) {
            
            Swal.fire({
        icon: 'success',
        title: 'Success!',
        text: 'User added successfully!',
        showConfirmButton: false, // Hide the confirm button
        timer: 1500 // Show for 1.5 seconds
    }).then(() => {
        clearForm();
        fetchUsers(); // Refresh the table
    });
            
        } else {
            
            Swal.fire({
						icon: 'error',
						title: 'Oops!',
						text: 'Failed to add user!',
						showConfirmButton: false, // Hide the confirm button
                        timer: 1500
					});
        }
    }

    async function updateUser() {
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;
        const role = document.getElementById('role').value;
        const userId = document.getElementById('userId').value;
        console.log("uerID")
        console.log(userId)
        console.log(sessionStorage.getItem('token'))
        const response = await fetch('https://footballsite-apis-1.onrender.com/api/users/profile', {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
                 'Authorization': `Bearer ${sessionStorage.getItem('token')}`
            },
            body: JSON.stringify({ userId, username, password, role })
        });

        
        if (response.ok) {
         
            Swal.fire({
        icon: 'success',
        title: 'Success!',
        text: 'User updated successfully!',
        showConfirmButton: false, // Hide the confirm button
        timer: 1500 // Show for 1.5 seconds
    }).then(() => {
        clearForm();
        fetchUsers(); // Refresh the table
    });
        } else {
            Swal.fire({
						icon: 'error',
						title: 'Oops!',
						text: 'Failed to update user!',
						showConfirmButton: false, // Hide the confirm button
                        timer: 1500
					});
        }
    }
         

            async function deleteUser() {
        
        const currentUserId = sessionStorage.getItem('userID'); // Get the current user ID from local storage
        const userId = document.getElementById('userId').value;
        console.log("UserID")
        console.log(currentUserId)
        const response = await fetch('https://footballsite-apis-1.onrender.com/api/users/delete', {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${sessionStorage.getItem('token')}`
            },
            body: JSON.stringify({ currentUserId, userId })
        });

        if (response.ok) {
            Swal.fire({
        icon: 'success',
        title: 'Success!',
        text: 'User deleted successfully!',
        showConfirmButton: false, // Hide the confirm button
        timer: 1500 // Show for 1.5 seconds
    }).then(() => {
        clearForm();
        fetchUsers(); // Refresh the table
    });
        } else {
            Swal.fire({
						icon: 'error',
						title: 'Oops!',
						text: 'Failed to delete user!',
						showConfirmButton: false, // Hide the confirm button
                        timer: 1500
					});
        }
    }
        
            function clearForm() {
                document.getElementById('userForm').reset();
                document.getElementById('useraddButton').style.display = 'inline-block';
                document.getElementById('userupdateButton').style.display = 'none';
                document.getElementById('userdeleteButton').style.display = 'none';
                document.getElementById('usercancelButton').style.display = 'none';
            }
        
        </script>

<script>
   
        const approvedTableBody = document.querySelector('#approvedTable tbody');

        // Function to fetch approved bookings
        const fetchApprovedBookings = async () => {
            try {
                const response = await fetch('https://footballsite-apis-1.onrender.com/api/bookings/approved');
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
               
                const bookings = await response.json();
                const reversedBookings = bookings.reverse();
                populateApprovedTable(reversedBookings);
            } catch (error) {
                console.error('There was a problem with the fetch operation:', error);
            }
        };

        // Function to populate the table with approved bookings
        const populateApprovedTable = (bookings) => {
            approvedTableBody.innerHTML = ''; // Clear any existing rows
            bookings.forEach(booking => {
                const row = document.createElement('tr');
                const fullName = `${booking.Firstname} ${booking.lastName}`; // Combine Firstname and Lastname
                row.innerHTML = `
                    <td>${new Date(booking.todayDate).toLocaleDateString()}</td> <!-- Format date -->
                    <td>${fullName}</td>
                    <td>${booking.startTime} - ${booking.endTime}</td>
                    <td>${booking.phone}</td>
                    <td>${booking.amount}</td>
                `;
                approvedTableBody.appendChild(row);
            });
        };

        // Fetch bookings on page load
        fetchApprovedBookings();

        // Refresh bookings every 5 minutes (300000 milliseconds)
        setInterval(fetchApprovedBookings, 300000);
   
</script>
<script>
  
        const declinedTableBody = document.querySelector('#DeclinedTable tbody');

        // Function to fetch declined bookings
        const fetchDeclinedBookings = async () => {
            try {
                const response = await fetch('https://footballsite-apis-1.onrender.com/api/bookings/cancelled');
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                const bookings = await response.json();
                const reversedBookings = bookings.reverse();
                
                populateDeclinedTable(reversedBookings);
            } catch (error) {
                console.error('There was a problem with the fetch operation:', error);
            }
        };

        // Function to populate the table with approved bookings
        const populateDeclinedTable = (bookings) => {
            declinedTableBody.innerHTML = ''; // Clear any existing rows
            bookings.forEach(booking => {
                const row = document.createElement('tr');
                const fullName = `${booking.Firstname} ${booking.lastName}`; // Combine Firstname and Lastname
                row.innerHTML = `
                    <td>${new Date(booking.todayDate).toLocaleDateString()}</td> <!-- Format date -->
                    <td>${fullName}</td>
                    <td>${booking.startTime} - ${booking.endTime}</td>
                    <td>${booking.phone}</td>
                    <td>${booking.amount}</td>
                `;
                declinedTableBody.appendChild(row);
            });
        };

        // Fetch bookings on page load
        fetchDeclinedBookings();

        // Refresh bookings every 5 minutes (300000 milliseconds)
        setInterval(fetchDeclinedBookings, 300000);
    
</script>

<script>
   
        const allBookingsTableBody = document.querySelector('#AllBookingsTable tbody');

        // Function to fetch all bookings
        const fetchallBookings = async () => {
            try {
                const response = await fetch('https://footballsite-apis-1.onrender.com/api/bookings');
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                const bookings = await response.json();
                const reversedBookings = bookings.reverse();
                populateallBookingsTable(reversedBookings);
               // populateallBookingsTable(bookings);
            } catch (error) {
                console.error('There was a problem with the fetch operation:', error);
            }
        };

        // Function to populate the table with bookings
        const populateallBookingsTable = (bookings) => {
            allBookingsTableBody.innerHTML = ''; // Clear any existing rows
            bookings.forEach(booking => {
                const row = document.createElement('tr');
                row.onclick = () => populateBookingsFormDet(booking);
                const fullName = `${booking.Firstname} ${booking.lastName}`; // Combine Firstname and Lastname
                const status = booking.status; // Assuming 'status' is a field in your booking object

                row.innerHTML = `
                     <td style="display: none;" >${booking._id}</td>
                    <td>${new Date(booking.todayDate).toLocaleDateString()}</td> <!-- Format date -->
                    <td>${booking.Firstname}</td>
                    <td>${booking.lastName}</td>
                    <td>${booking.startTime}</td>
                    <td>${booking.endTime}</td>
                    <td>${booking.phone}</td>
                    <td>${booking.amount}</td>
                    <td style="white-space: nowrap;">
                        ${status.toLowerCase() === 'pending' ? `
                            <button class="btn btn-success btn-sm approve-btn" data-id="${booking._id}" style="width: 80px; margin-right: 5px;">Approve</button>
                            <button class="btn btn-danger btn-sm decline-btn" data-id="${booking._id}" style="width: 80px;">Decline</button>
                        ` : status === 'Approved' ? 'Approved' : 'Declined'}
                    </td>
                `;

                allBookingsTableBody.appendChild(row);


            });

            // Attach click event listeners to approve and decline buttons
            attachButtonListeners();
        };

         // Function to attach event listeners to buttons
         const attachButtonListeners = () => {
            const approveButtons = document.querySelectorAll('.approve-btn');
            const declineButtons = document.querySelectorAll('.decline-btn');

            approveButtons.forEach(button => {
                button.addEventListener('click', () => handleApprove(button.dataset.id));
            });

            declineButtons.forEach(button => {
                button.addEventListener('click', () => handleDecline(button.dataset.id));
            });
        };

        // Function to handle approval of a booking
        const handleApprove = async (id) => {
            try {
                const response = await fetch('https://footballsite-apis-1.onrender.com/api/bookings/approve', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ id }), // Send the booking ID in the request body
                });

                if (response.ok) {
                   // send whatsapp message 
                   const booking = await response.json();
                    const formattedPhone = formatPhoneForWhatsApp(booking.phone);

                    // Calculate total price
                    const startTime = new Date(`2000-01-01T${booking.startTime}`);
                    const endTime = new Date(`2000-01-01T${booking.endTime}`);
                    const durationHours = (endTime - startTime) / (1000 * 60 * 60);
                    const totalPrice = durationHours * 100; // 100 shekels per hour

                    const message = encodeURIComponent(`مرحبًا ${booking.Firstname}، تمت الموافقة على حجزك!

التفاصيل:
اليوم: ${new Date(booking.todayDate).toLocaleDateString('ar-EG')}
وقت البدء: ${booking.startTime}
وقت الانتهاء: ${booking.endTime}
المدة: ${durationHours} ساعة
السعر الإجمالي: ${totalPrice.toFixed(2)} شيكل

شكرًا لحجزك!`);

                         

                    window.open(`https://wa.me/${formattedPhone}?text=${message}`, '_blank');



                    Swal.fire({
        icon: 'success',
        title: 'Success!',
        text: 'Booking approved successfully!',
        showConfirmButton: false, // Hide the confirm button
        timer: 1500 // Show for 1.5 seconds
    }).then(() => {
        fetchallBookings();
        fetchApprovedBookings();

    });

                } else {
                    Swal.fire({
						icon: 'error',
						title: 'Oops!',
						text: 'Failed to approve booking!',
						showConfirmButton: false, // Hide the confirm button
                        timer: 1500
					});

                }
            } catch (error) {
                console.error('Error approving booking:', error);
            }
        };

        // Function to handle declining a booking (you can implement this if needed)
        const handleDecline = async (id) => {
            try {
                const response = await fetch('https://footballsite-apis-1.onrender.com/api/bookings/cancel', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ id }), // Send the booking ID in the request body
                });

                if (response.ok) {
                    
                    Swal.fire({
        icon: 'success',
        title: 'Success!',
        text: 'Booking Declined successfully!',
        showConfirmButton: false, // Hide the confirm button
        timer: 1500 // Show for 1.5 seconds
    }).then(() => {
        fetchallBookings();
        fetchDeclinedBookings();
    });
                } else {
                    
                    Swal.fire({
						icon: 'error',
						title: 'Oops!',
						text: 'Failed to decline booking!',
						showConfirmButton: false, // Hide the confirm button
                        timer: 1500
					});
                }
            } catch (error) {
                console.error('Error declining booking:', error);
            }
        };

        // Fetch bookings on page load
        fetchallBookings();

        // Refresh bookings every 5 minutes (300000 milliseconds)
        setInterval(fetchallBookings, 300000);
   

        // Function to format phone number for WhatsApp
function formatPhoneForWhatsApp(phone) {
           

    // Remove any non-digit characters
    let cleanNumber = phone.replace(/\D/g, '');
    
    // Check if it's an Israeli number
    if (cleanNumber.startsWith('05')) {
        return '972' + cleanNumber.substring(1);
    }
    // Check if it's a Palestinian number
    else if (cleanNumber.startsWith('059') || cleanNumber.startsWith('056')) {
        return '970' + cleanNumber.substring(1);
    }
    // If it already has a country code, return as is
    else if (cleanNumber.startsWith('972') || cleanNumber.startsWith('970')) {
        return cleanNumber;
    }
    // Default case: assume it's a local number and add Palestinian code
    else {
        return '970' + cleanNumber;
    }
}

// filter booking table
function filterTable() {
    const searchInput = document.getElementById("searchInput").value.toLowerCase();
    const table = document.getElementById("AllBookingsTable");
    const rows = table.getElementsByTagName("tr");

    for (let i = 1; i < rows.length; i++) {
        const cells = rows[i].getElementsByTagName("td");
        let rowText = "";
        
        for (let j = 0; j < cells.length; j++) {
            rowText += cells[j].textContent.toLowerCase() + " ";
        }

        // Check if the row contains the search input
        rows[i].style.display = rowText.includes(searchInput) || searchInput === "" ? "" : "none";
    }
}


// edit bookings table 
function populateBookingsFormDet(booking) {
                
                document.getElementById('bookingID').value = booking._id;
               document.getElementById('firstnameBooking').value = booking.Firstname;
               document.getElementById('lastnameBooking').value = booking.lastName;
              document.getElementById('phone').value = booking.phone;
              document.getElementById('todayDate').value = new Date(booking.todayDate).toISOString().split('T')[0];;
              document.getElementById('startTime').value = booking.startTime;
              document.getElementById('endTime').value = booking.endTime;
              document.getElementById('amountBooking').value = booking.amount;
                
        
                // Show the Update and Delete buttons
                document.getElementById('Bookingsadd').style.display = 'none';
                document.getElementById('Bookingsupdate').style.display = 'inline-block';
                document.getElementById('Bookingsdelete').style.display = 'inline-block';
                document.getElementById('Bookingscancel').style.display = 'inline-block';
            }
    
        
            async function addBookings() {
        // Collect the form data
        const firstname = document.getElementById('firstnameBooking').value;
            const lastname = document.getElementById('lastnameBooking').value;
            const phone = document.getElementById('phone').value;
            const todayDate = document.getElementById('todayDate').value;
            const startTime = document.getElementById('startTime').value;
            const endTime = document.getElementById('endTime').value;
            const amount = document.getElementById('amountBooking').value;
            

            // Fetch all bookings and check for conflicts
        const bookings = await fetchAllBookingsDATA();
        const isBooked = bookings.some(booking => 
            booking.todayDate.split('T')[0]=== todayDate && 
            booking.startTime === startTime 
           
        );

        if (isBooked) {
            Swal.fire({
        icon: 'error',
        title: 'Oops!',
        text: 'Request already exist for choosen time and date. Please change the time or date!',
        confirmButtonText: 'Okay'
    });
            return;
        }
    
            // Prepare the request body
            const requestBody = {
                Firstname: firstname,
                lastName: lastname,
                phone: phone,
                todayDate: todayDate,
                startTime: startTime,
                endTime: endTime,
                amount : amount

            };
    
            // add booking api 
            fetch('https://footballsite-apis-1.onrender.com/api/bookings/add', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(requestBody),
            })
            .then(response => {
        if (response.status === 201) {
          //  console.log(JSON.stringify(requestBody))
            return response.json(); // Parse the JSON if the response is successful
        } else {
            throw new Error('Something went wrong!'); // Handle other response statuses
        }
    })
    .then(data => {
       // Show SweetAlert success message
    Swal.fire({
        icon: 'success',
        title: 'Success!',
        text: 'Request added successfully!',
        confirmButtonText: 'Okay'
    });
    clearBookingsForm();
        
       fetchallBookings();// Refresh the table
    
        fetchApprovedBookings();
        fetchDeclinedBookings();
    })
    .catch(error => {
        console.error('Error:', error);
        //responseMessageElement.innerText = 'An error occurred. Please try again.';
        Swal.fire({
        icon: 'error',
        title: 'Oops!',
        text: 'An error occurred. Please try again.',
        confirmButtonText: 'Okay'
    });
    });
}

    async function updateBookings() {
      
    // Collect the form data
    const id = document.getElementById('bookingID').value;
    const firstname = document.getElementById('firstnameBooking').value;
    const lastname = document.getElementById('lastnameBooking').value;
    const phone = document.getElementById('phone').value;
    const todayDate = document.getElementById('todayDate').value;
    const startTime = document.getElementById('startTime').value;
    const endTime = document.getElementById('endTime').value;
    const amount = parseFloat(document.getElementById('amountBooking').value); // Ensure amount is a number


     
    const bookings = await fetchAllBookingsDATA();
        const isBooked = bookings.some(booking => 
            booking.todayDate.split('T')[0]=== todayDate && 
            booking.startTime === startTime &&
            booking._id !== id
           
        );

        if (isBooked) {
            Swal.fire({
        icon: 'error',
        title: 'Oops!',
        text: 'Request already exist for choosen time and date. Please change the time or date!',
        confirmButtonText: 'Okay'
    });
            return;
        }

         // Prepare the request body
    const requestBody = {
        id,
        Firstname: firstname,
        lastName: lastname,
        phone: phone,
        todayDate: todayDate,
        startTime: startTime,
        endTime: endTime,
        amount: amount
    };

     

        const response = await fetch('https://footballsite-apis-1.onrender.com/api/bookings/update', {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
                 
            },
            body: JSON.stringify(requestBody),
        });

        
        if (response.ok) {
         
            Swal.fire({
        icon: 'success',
        title: 'Success!',
        text: 'Booking updated successfully!',
        showConfirmButton: false, // Hide the confirm button
        timer: 1500 // Show for 1.5 seconds
    }).then(() => {
        clearBookingsForm();
        fetchallBookings(); // Refresh the table
        fetchApprovedBookings();
        fetchDeclinedBookings();
    });
        } else {
            Swal.fire({
						icon: 'error',
						title: 'Oops!',
						text: 'Failed to update Booking!',
						showConfirmButton: false, // Hide the confirm button
                        timer: 1500
					});
        }
    }
         

            async function deleteBookings() {
        
        const id = document.getElementById('bookingID').value;

      
        const response = await fetch('https://footballsite-apis-1.onrender.com/api/bookings/delete', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                
            },
            body: JSON.stringify({ id })
        });


        if (response.ok) {
            Swal.fire({
        icon: 'success',
        title: 'Success!',
        text: 'Booking deleted successfully!',
        showConfirmButton: false, // Hide the confirm button
        timer: 1500 // Show for 1.5 seconds
    }).then(() => {
        clearBookingsForm();
        fetchallBookings(); // Refresh the table
        fetchApprovedBookings();
        fetchDeclinedBookings();
    });
        } else {
            Swal.fire({
						icon: 'error',
						title: 'Oops!',
						text: 'Failed to delete Booking!',
						showConfirmButton: false, // Hide the confirm button
                        timer: 1500
					});
        }
    }
        
            function clearBookingsForm() {
                document.getElementById('bookingForm').reset();
                document.getElementById('Bookingsadd').style.display = 'inline-block';
                document.getElementById('Bookingsupdate').style.display = 'none';
                document.getElementById('Bookingsdelete').style.display = 'none';
                document.getElementById('Bookingscancel').style.display = 'none';
            }



            const fetchAllBookingsDATA = async () => {
        try {
            const response = await fetch('https://footballsite-apis-1.onrender.com/api/bookings');
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            const bookings = await response.json();
            const reversedBookings = bookings.reverse();

            return await reversedBookings; // Return the booking data
        } catch (error) {
            console.error('Error fetching bookings:', error);
            return []; // Return an empty array on error
        }
    };

    document.getElementById('startTime').addEventListener('change', function() {
        const startTime = this.value;
        if (startTime) {
            const [hours, minutes] = startTime.split(':').map(Number);
            // Round down to the nearest hour
            const roundedHours = hours;
            const roundedMinutes = 0; // Set to 00
            document.getElementById('startTime').value = `${String(roundedHours).padStart(2, '0')}:${String(roundedMinutes).padStart(2, '0')}`;

            const endTime = new Date();
            endTime.setHours(roundedHours + 1);
            endTime.setMinutes(0); // Set minutes to 0
            const endHours = String(endTime.getHours()).padStart(2, '0');
            document.getElementById('endTime').value = `${endHours}:00`;

            // Calculate amount
            const amount = 100; // Amount per hour
            document.getElementById('amountBooking').value = (1 * amount).toFixed(2); // Always 1 hour
        }
    });


</script>



    <!-- jQuery and Bootstrap Bundle (includes Popper) -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    

</body>

</html>